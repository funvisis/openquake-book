In this chapter we discuss the properties of the two main calculators 
needed to process the information contained in the PSHA input model 
and prepare it for hazard calculation: the Logic Tree processor and the 
Earthquake Rupture Forecast calculator. 

\section{The Logic Tree Processor}
\label{hazard:logic_tree_processor}
\index{Logic Tree!Processor}
%
The Logic Tree Processor is responsible for processing data contained in a 
logic tree structure (see \ref{hazard:logic_tree}), that is selecting a 
source model from the source model logic tree (see 
\ref{hazard:source_model_logic_tree}) and a ground motion prediction equation 
from the GMPE logic tree (see \ref{hazard:gmpe_logic_tree}). The selected 
source model and GMPE can be then passed to the different OpenQuake-Hazard 
calculators (Classical PSHA calculator, \ref{chap:classic_psha}; Stochastic 
PSHA calculator, \ref{chap:stochastic_psha}).\\
The capability to process the information contained in a logic tree is 
constrained by the size and complexity of the logic tree itself. For a 
large logic tree, performing a seismic hazard calculation for all possible 
end-branch models is an unfeasible task. Under this condition, a Monte Carlo
sampling of the logic tree is a more efficient approach. On the contrary, 
for a small logic tree, a Monte Carlo approach is inefficient with respect
to enumerating all the possible end-branch models and performing a hazard 
analysis for each of them. In other words, to get stable results in case of 
a simple logic tree,  a Monte Carlo approach would require sampling epistemic
uncertainties a number of times much larger than the actual number of 
end-branch models.\\
The general plan for OpenQuake is to provide both the two processing strategies. 
Currently, the logic tree processor can only provide a Monte Carlo sampler.
%
\subsection{The Logic Tree Monte Carlo Sampler}
Aim of the Logic Tree Monte Carlo Sampler (hereinafter LTMCS) is to sample 
epistemic uncertainties, so that the distribution of the final hazard results
reflect the degrees of belief that the hazard modeler specified in the 
different logic tree branches.\\
%
\subsubsection{Sampling the source model logic tree}
As described in \ref{hazard:source_model_logic_tree}, the first branching 
level in the source model logic tree is used for defining one or more 
alternative source models. Subsequent branches define parameter-specific 
epistemic uncertainties. Each branching level contains only one branch set 
(therefore producing a symmetric logic tree). The LTMCS constructs a source 
model by looping over all the branching levels. In the first branching level, 
a source model is randomly selected, with a probability equal to the 
uncertainty weight. Epistemic uncertainties defined in subsequent branching 
levels are then applied to this initially selected source model. For each 
following branching level, a loop over the seismic sources defined in the 
selected source model is started, and for each seismic source an epistemic 
uncertainty value is randomly selected (again with a probability equal to 
the uncertainty weight).