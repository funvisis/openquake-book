OpenQuake offers the possibility to perform different types of analysis/calculations for seismic hazard assessment:
\begin{itemize}
\item Classical (Cornell-type) PSHA
\item Event based PSHA
\item Disaggregation analysis
\item Uniform Hazard Spectra calculation
\item Deterministic (single earthquake scenario) SHA
\end{itemize}

and for seismic risk assessment:
\begin{itemize}
\item ...
\item ...
\end{itemize}

For each type of analysis, a configuration file (consisting of statements in the format \Verb+key=value+) and one or more input data files in nrML format (an XML based format) are required.

The different types of analysis can be selected inside the \Verb+[general]+ section of the configuration file, by setting  the \Verb+CALCULATION_MODE+ key:
\begin{Verbatim}[frame=single]
[general]

CALCULATION_MODE =
\end{Verbatim}

Valid values are: 
\begin{itemize}
\item \Verb+Classical+ (for Classical PSHA)
\item \Verb+Event Based+ (for Event Based PSHA)
\item \Verb+Disaggregation+ (for Disaggregation analysis)
\item \Verb+UHS+ (for Uniform Hazard Spectra calculation)
\item \Verb+Deterministic+ ( for Deterministic SHA)
\item ...
\end{itemize}

Each analysis is performed over a set of geographical locations, that can be defined as grid points in a geographical region:

\begin{Verbatim}[frame=single]
REGION_VERTEX = LAT_1, LON_1, LAT_2, LON_2, ..., LAT_N, LON_N
REGION_GRID_SPACING = DELTA_GRID
\end{Verbatim}

where \Verb+REGION_VERTEX+ is a list of vertices coordinates (latitude, longitude) defining a polygonal region. The list of vertices can be defined in clock or counter-clock wise order. \Verb+REGION_GRID_SPACING+ defines the discretization step utilized for the grid construction. No restrictions are given in the number of vertices in the polygon definition.

A second option is to define a list of independent geographical locations:
\begin{Verbatim}[frame=single]
SITES = LAT_1, LON_1, LAT_2, LON_2,..., LAT_N, LON_N
\end{Verbatim}
each location being defined by latitude and longitude. Again no restrictions are given in the number of locations.

In case of risk analysis, a third option allows to perform calculations on the geographical locations defined in the exposure model. To select this option, the key \Verb+COMPUTE_HAZARD_AT_ASSETS_LOCATIONS+ must be set to \Verb+true+ in the \Verb+[RISK]+ section of the configuration file.

Once the \Verb+CALCULATION_MODE+ and the locations of interest have been defined, the user is required to define the input data (in nrML format) and the calculation parameters (in the configuration file) for the requested analysis.

\section{Input Data definition for Classical, Event Based, Disaggregation and UHS hazard analysis}
Input data for probabilistic based seismic hazard analysis (Classical, Event based, Disaggregation, and UHS) are structured in terms of a:
\begin{itemize}
\item file describing the \gls{seismicsourcesystem}. That is the set of initial source models and associated epistemic uncertainties needed to model the seismic activity in the region of interest.
\item file describing the \glspl{groundmotionsystem}. That is the set of ground motion prediction equations, per tectonic region type, needed to model the ground motion shaking in the region of interest.
\end{itemize}
The paths to the \gls{seismicsourcesystem} and  \glspl{groundmotionsystem} files are given in the 
\Verb+SOURCE_MODEL_LOGIC_TREE_FILE+ and \Verb
+GMPE_LOGIC_TREE_FILE+ keys, respectively, both defined in the \Verb+[HAZARD]+ section of the configuration file.

\subsection{The Seismic Source and Ground Motion System definition}
The information required to define both the Seismic Source and Ground Motion Systems is stored in a \Verb+logicTree+ element: 
\begin{Verbatim}[frame=single, commandchars=\\\{\}]
<\textcolor{red}{logicTree} logicTreeID="ID">
...
</\textcolor{red}{logicTree}>
\end{Verbatim}
A \Verb+logicTree+ is defined as a sequence of \Verb+logicTreeBranchingLevel+ elements. The position in the sequence specifies in which level of the tree the branching level is located. That is, the first logicTreeBranchingLevel element in the sequence represents the first level in the tree, the second element the second level in the tree, and so on.
\begin{Verbatim}[frame=single, commandchars=\\\{\}]
<\textcolor{red}{logicTree} logicTreeID="ID">
	<\textcolor{green}{logicTreeBranchingLevel} branchingLevelID="ID_1">
		...
	</\textcolor{green}{logicTreeBranchingLevel}>
	<\textcolor{green}{logicTreeBranchingLevel} branchingLevelID="ID_2">
		...
	</\textcolor{green}{logicTreeBranchingLevel}>
	....
	<\textcolor{green}{logicTreeBranchingLevel} branchingLevelID="ID_N">
		...
	</\textcolor{green}{logicTreeBranchingLevel}>
</\textcolor{red}{logicTree}>
\end{Verbatim}
No restrictions are present on the number of tree levels that can be defined.\\
A \Verb+logicTreeBranchingLevel+ is defined as a sequence of \Verb+logicTreeBranchSet+ elements. Each \Verb+logicTreeBranchSet+ defines a particular epistemic uncertainty inside a branching level. A branch set has two required attributes (\Verb+branchingLevelID+ and \Verb+uncertaintyType+ (defining the type of epistemic uncertainty the branch set is defining))
\begin{Verbatim}[frame=single, commandchars=\\\{\}]
<\textcolor{red}{logicTree} logicTreeID="ID">
...
	<\textcolor{green}{logicTreeBranchingLevel} branchingLevelID="ID_#">
		<\textcolor{blue}{logicTreeBranchSet} branchSetID="ID_1"
			uncertaintyType="UNCERTAINTY_TYPE">
			...
		</\textcolor{blue}{logicTreeBranchSet}>
		<\textcolor{blue}{logicTreeBranchSet} branchSetID="ID_2"
			uncertaintyType="UNCERTAINTY_TYPE">
			...
		</\textcolor{blue}{logicTreeBranchSet}>
		...
		<\textcolor{blue}{logicTreeBranchSet} branchSetID="ID_N"
			uncertaintyType="UNCERTAINTY_TYPE">
			...
		</\textcolor{blue}{logicTreeBranchSet}>
	</\textcolor{green}{logicTreeBranchingLevel}>
...
</\textcolor{red}{logicTree}>
\end{Verbatim}
Possible values for the \Verb+uncertaintyType+ attribute are:
\begin{itemize}
\item \Verb+gmpeModel+: identifying epistemic uncertainties on ground motion prediction equations
\item \Verb+sourceModel+: identifying epistemic uncertainties on source models
\item \Verb+maxMagGRRelative+: identifying epistemic uncertainties (relative: that is increments) to be added (or subtracted, depending on the sign of the increment) to the Gutenberg-Richter maximum magnitude value.
\item \Verb+bGRRelative+: identifying epistemic uncertainties (relative) to be applied to the Gutenberg-Richter b value.
\item \Verb+abGRAbsolute+:identifying epistemic uncertainties (absolute: that is new values used to replace original values) on the Gutenberg-Richter a and b values.
\item \Verb+maxMagGRAbsolute+: identifying epistemic uncertainties (absolute) on the Gutenberg-Richter maximum magnitude.
\end{itemize}
No restrictions are given on the number of branch sets that can be defined inside a branching level.\\
A \Verb+branchSet+ is defined as a sequence of  \Verb+logicTreeBranch+ elements, each defined by an \Verb+uncertainityModel+ element (a string identifying an uncertainty model; the content of the string varies with the uncertaintyType attribute value of the branchSet element) and the uncertaintyWeight element (specifying the probability/weight associated to the uncertaintyModel):
\begin{Verbatim}[frame=single, commandchars=\\\{\}]
<\textcolor{red}{logicTree} logicTreeID="ID">
...
	<\textcolor{green}{logicTreeBranchingLevel} branchingLevelID="ID_#">
		...
		<\textcolor{blue}{logicTreeBranchSet} branchSetID="ID_#"
				uncertaintyType="UNCERTAINTY_TYPE">
			<\textcolor{magenta}{logicTreeBranch} branchID="ID_1">
				<uncertaintyModel>
					UNCERTAINTY_MODEL
				</uncertaintyModel>
				<uncertaintyWeight>
					UNCERTAINTY_WEIGHT
				</uncertaintyWeight>
			</\textcolor{magenta}{logicTreeBranch}>
			...
			<\textcolor{magenta}{logicTreeBranch} branchID="ID_N">
				<uncertaintyModel>
					UNCERTAINTY_MODEL
				</uncertaintyModel>
				<uncertaintyWeight>
					UNCERTAINTY_WEIGHT
				</uncertaintyWeight>
			</\textcolor{magenta}{logicTreeBranch}>
		</\textcolor{blue}{logicTreeBranchSet}>
		...
	</\textcolor{green}{logicTreeBranchingLevel}>
...
</\textcolor{red}{logicTree}>
\end{Verbatim}
No restrictions are given on the number of \Verb+logicTreeBranch+ elements that can be defined in a \Verb+logicTreeBranchSet+, as long as the uncertainty weights sum to 1.0.\\
The \Verb+logicTreeBranchSet+ element offers also a number of optional attributes allowing for complex tree definitions:
\begin{itemize}
\item \Verb+applyToBranches+: specifies to which \Verb+logicTreeBranch+ elements (one or more), in the previous branching level, the branch set is linked to. The default is the keyword ALL, which means that a branch set is by default linked to all branches in the previous branching level. By specifying one or more branches to which the branch set links to, non-symmetric logic trees can be defined.
\item \Verb+applyToSources+: specifyies to which source in a source model the uncertainty applies to.
\item \Verb+applyToSourceType+: specifies to which source type the uncertainty applies to.
\item \Verb+applyToTectonicRegionType+: specifies to which tectonic region type the uncertainty applies to.
\end{itemize}

\subsubsection{Seismic source definition in nrML format}\label{seismicSourceNrml}
Four source typologies can be currently defined:
\begin{itemize}
\item Area
\item Point
\item Simple Fault
\item Complex Fault
\end{itemize}
Each source typology is identified by a specific element name in the nrML format:
\begin{itemize}
\item \Verb+areaSource+ (for Area)
\item \Verb+pointSource+ (for Point)
\item \Verb+simpleFaultSource+ (for Simple Fault)
\item \Verb+complexFaultSource+ (for Complex Fault)
\end{itemize}
and is characterized by three common attributes:
\begin{itemize}
\item ID: unique identifier 
\item name: source name
\item tectonic region type: tectonic region the source belongs to. 
\end{itemize}
The tectonic region type can be one of five typologies:
\begin{itemize}
\item \Verb+Active Shallow Crust+
\item \Verb+Stable Shallow Crust+
\item \Verb+Subduction Interface+
\item \Verb+Subduction IntraSlab+
\item \Verb+Volcanic+
\end{itemize}
In the nrML format, each source is therefore defined as follows:
\begin{itemize}
\item area:
\begin{Verbatim}[frame=single]
 <areaSource gml:id="SOURCE_ID">
    <gml:name>SOURCE_NAME</gml:name>
     <tectonicRegion>TECTONIC_REGION_TYPE</tectonicRegion>
      ...
\end{Verbatim}
\item point:
\begin{Verbatim}[frame=single]
<pointSource gml:id="SOURCE_ID">
    <gml:name>SOURCE_NAME</gml:name>
    <tectonicRegion>TECTONIC_REGION_TYPE</tectonicRegion>
     ...
\end{Verbatim}
\item simple fault:
\begin{Verbatim}[frame=single]
<simpleFaultSource gml:id="SOURCE_ID">
   <gml:name>SOURCE_NAME</gml:name>
   <tectonicRegion>TECTONIC_REGION_TYPE</tectonicRegion>
    ...
\end{Verbatim}
\item complex fault:
\begin{Verbatim}[frame=single]
<complexFaultSource gml:id="SOURCE_ID">
   <gml:name>SOURCE_NAME</gml:name>
   <tectonicRegion>TECTONIC_REGION_TYPE</tectonicRegion>
    ...
\end{Verbatim}
\end{itemize}
\subsubsection{Area source definition}
An area source can be utilized to describe a polygonal geographical region where seismicity is assumed to be uniform.
The geographic region is defined by the \Verb+areaBoundary+ element. More specifically the area boundary is defined by a list of vertices coordinates (longitude, latitude) in a \Verb+LinearRing+ element defining the exterior boundary of a \Verb+Polygon+ element:
\begin{Verbatim}[frame=single]
 <areaBoundary>
    <gml:Polygon>
      <gml:exterior>
        <gml:LinearRing>
           <gml:posList>
             LON_1 LAT_1
             LON_2 LAT_2
             ...			
             LON_N LAT_N
           </gml:posList>
         </gml:LinearRing>
        </gml:exterior>
      </gml:Polygon>
</areaBoundary>
\end{Verbatim}
The occurrence rates are specified in the \Verb+ruptureRateModel+ element, which contains the definition of a magnitude frequency distribution (\Verb+truncatedGutenbergRichter+ or \Verb+evenlyDiscretizedIncrementalMFD+) and a focal mechanism (\Verb+focalMechanism+).
\begin{Verbatim}[frame=single]
<ruptureRateModel>
   <truncatedGutenbergRichter> or <evenlyDiscretizedIncrementalMFD>
	...
   <focalMechanism>
	...
</ruptureRateModel>
\end{Verbatim}
A truncated Gutenberg-Richter magnitude frequency distribution is defined as follows:
\begin{Verbatim}[frame=single]
<truncatedGutenbergRichter>
   <aValueCumulative>CUMULATIVE_A_VALUE</aValueCumulative>
   <bValue>B_VALUE</bValue>
   <minMagnitude>MINIMUM_MAGNITUDE</minMagnitude>
   <maxMagnitude>MAXIMUM_MAGNITUDE</maxMagnitude>
</truncatedGutenbergRichter>
\end{Verbatim}
A generic evenly-discretized magnitude frequency distribution is defined instead as:
\begin{Verbatim}[frame=single]
<evenlyDiscretizedIncrementalMFD binSize="BIN_SIZE"
 	 minVal="MINIMUM_VALUE">
              RATE_1
              RATE_2
              ...
              RATE_N
</evenlyDiscretizedIncrementalMFD>
\end{Verbatim}
where \Verb+BIN_SIZE+ represents the discretization interval of the magnitude-frequency distribution, and \Verb+MINIMUM_VALUE+ represents the minimum value in the distribution (interpreted as the middle-point value of the first bin in the distribution).
A focal mechanism is defined in terms of a strike, dip and rake values:
\begin{Verbatim}[frame=single]
        <focalMechanism publicID="smi:fm1/0">
          <qml:nodalPlanes>
            <qml:nodalPlane1>
              <qml:strike>
                <qml:value>STRIKE_VALUE</qml:value>
              </qml:strike>
              <qml:dip>
                <qml:value>DIP_VALUE</qml:value>
              </qml:dip>
              <qml:rake>
                <qml:value>RAKE_VALUE</qml:value>
              </qml:rake>
            </qml:nodalPlane1>
          </qml:nodalPlanes>
        </focalMechanism>
 \end{Verbatim}
where $ 0^{\circ} \leq STRIKE_VALUE  \leq 360 ^{\circ}$
In a single area source definition, one or more \Verb+ruptureRateModel+ elements can be defined, so that multiple focal mechanisms (each having a specific magnitude-frequency distribution) can be defined:
\begin{Verbatim}[frame=single]
 <areaSource gml:id="SOURCE_ID">
 ...
 	<ruptureRateModel>
 	...
	 </ruptureRateModel>
	 <ruptureRateModel>
 	...
 	</ruptureRateModel>
...
 </areaSource>
\end{Verbatim}
\begin{comment}
\begin{Verbatim}[frame=single]
    <areaSource gml:id="src_1">
      <gml:name>Source 8.CH.3</gml:name>
      <tectonicRegion>Active Shallow Crust</tectonicRegion>
      <areaBoundary>
        <gml:Polygon>
          <gml:exterior>
            <gml:LinearRing>
              <gml:posList>-0.5 -0.5 -0.5 0.5 0.5 0.5 0.5 -0.5</gml:posList>
            </gml:LinearRing>
          </gml:exterior>
        </gml:Polygon>
      </areaBoundary>
      <ruptureRateModel>
        <truncatedGutenbergRichter>
          <aValueCumulative>2.5</aValueCumulative>
          <bValue>0.7318999871612379</bValue>
          <minMagnitude>5.0</minMagnitude>
          <maxMagnitude>8.0</maxMagnitude>
        </truncatedGutenbergRichter>
        <focalMechanism publicID="smi:fm1/0">
          <qml:nodalPlanes>
            <qml:nodalPlane1>
              <qml:strike>
                <qml:value>0.0</qml:value>
              </qml:strike>
              <qml:dip>
                <qml:value>90.0</qml:value>
              </qml:dip>
              <qml:rake>
                <qml:value>0.0</qml:value>
              </qml:rake>
            </qml:nodalPlane1>
          </qml:nodalPlanes>
        </focalMechanism>
      </ruptureRateModel>
      <ruptureDepthDistribution>
        <magnitude>6.5 7.5</magnitude>
        <depth>2.5 0.0</depth>
      </ruptureDepthDistribution>
      <hypocentralDepth>5.0</hypocentralDepth>
    </areaSource>
\end{Verbatim}
\end{comment}
\subsection{The Ground Motion System definition}
\begin{comment}
In this Chapter we provide with the reader a description of the input 
files containing the information necessary to completely describe a 
\gls{pshainputmodel} following a format compatible with \gls{acr:oq}. 
%
In OpenQuake the information commonly characterizing a 
\gls{pshainputmodel} is organized into - at least - four main files:
%
\begin{itemize}
	\item A \gls{configurationfile} (usually named config.gem) - It contains the 	
	\item A file describing the \gls{seismicsourcesystem}
	\item One or several files corresponding to the number of 
		\glspl{initialseismicsourcemodel}
	\item A file containing the information relative to the 
		\glspl{groundmotionsystem}
\end{itemize}

%
% ==============================================================================
\section{Anatomy of the configuration file for hazard calculation}
The configuration file contains the following parts
parts\footnote{
Each line starting with a cancel symbol is a comment line that is skipped
by the file parser.
}:
\begin{itemize}
	\item general 
	\item hazard
\end{itemize}
Each line starting with a cancel symbol is a comment line that is skipped
by the file parser. 

In order to discuss the content of the input file we use the 'config.gem' 
provided with the hazard demo relative to the PEER test set 1 case 10.

This is the general section of this file 
\begin{Verbatim}[baselinestretch=1,fontsize=\small,numbers=left,frame=single]
[general]
CALCULATION_MODE = Classical
# NOTE: The order of the vertices is to be kept!!!
# lat, lon of polygon vertices (in clock or counter-clock wise order)
REGION_VERTEX = 38.000, -122.000, 38.000, -122.000, 38.000, ...
# degrees
REGION_GRID_SPACING = 0.1
\end{Verbatim}
%
The first line contains a label specifying the section (in this 
particular case the 'general' section.

The second part composing the configuration file contains hazard 
specific information that can be divided into the following units: 
general calculation parameters and PSHA input model files, 
ground-motion model, seismic source model section and, results.
%
%
\subsubsection{General calculation parameters and PSHA input model files}
%
\begin{Verbatim}[baselinestretch=1,fontsize=\small,numbers=left,frame=single]
[HAZARD]
SOURCE_MODEL_LT_RANDOM_SEED = 23
GMPE_LT_RANDOM_SEED = 5
GMF_RANDOM_SEED = 3

# file containing erf logic tree structure
SOURCE_MODEL_LOGIC_TREE_FILE = source_model_logic_tree.xml
# file containing gmpe logic tree structure
GMPE_LOGIC_TREE_FILE = gmpe_logic_tree.xml
# output directory - relative to this file
OUTPUT_DIR = computed_output

# moment magnitude (Mw)
MINIMUM_MAGNITUDE = 5.0
# years
INVESTIGATION_TIME = 1.0
# maximum integration distance (km)
MAXIMUM_DISTANCE = 200.0
# bin width of the magnitude frequency distribution
WIDTH_OF_MFD_BIN = 0.1
\end{Verbatim}

%
% ============================================================================== 
\section{Description of the seismic source system file}
The seismic source system is described by an XML formatted file 
compatible with the NRML schema.
\marginpar{We miss a citation for NRML and a website as well!!}
%
\begin{Verbatim}[baselinestretch=1,fontsize=\small,numbers=left,frame=single]
	<logicTreeSet>
        <logicTree id="lt1">
            <logicTreeBranchSet branchingLevel="1" 
                                uncertaintyType="sourceModel">
                <logicTreeBranch>
                    <uncertaintyModel>source_model.xml</uncertaintyModel>
                    <uncertaintyWeight>1.0</uncertaintyWeight>
                </logicTreeBranch>
             </logicTreeBranchSet>
        </logicTree>
    </logicTreeSet>
\end{Verbatim}
%
% ------------------------------------------------------------------------------
\subsection{Basic seismic source typologies }

%
% ------------------------------------------------------------------------------
\subsection{Initial Seismic Source Model description}
The initial seismic source model used in this example is extremely simple, 
since it contains a single area source. 
%
\begin{Verbatim}[baselinestretch=1,fontsize=\small,numbers=left,frame=single]
    <areaSource gml:id="Src1">
      <gml:name>PEER test "AREA 1" model</gml:name>
      <tectonicRegion>Active Shallow Crust</tectonicRegion>
      <areaBoundary>
        <gml:Polygon>
          <gml:exterior>
            <gml:LinearRing>
              <gml:posList>
				-122.000 38.901 
				-121.920 38.899 
				...
				-122.160 38.892 
				-122.080 38.899 
			  </gml:posList>
            </gml:LinearRing>
          </gml:exterior>
        </gml:Polygon>
      </areaBoundary>
      <ruptureRateModel>
        <truncatedGutenbergRichter>
          <aValueCumulative>3.097</aValueCumulative>
          <bValue>0.9</bValue>
          <minMagnitude>5.0</minMagnitude>
          <maxMagnitude>6.5</maxMagnitude>
        </truncatedGutenbergRichter>
        <focalMechanism publicID="smi:f01/11">
          <qml:nodalPlanes>
            <qml:nodalPlane1>
              <qml:strike>
                <qml:value>0.0</qml:value>
              </qml:strike>
              <qml:dip>
                <qml:value>90.0</qml:value>
              </qml:dip>
              <qml:rake>
                <qml:value>0.0</qml:value>
              </qml:rake>
            </qml:nodalPlane1>
          </qml:nodalPlanes>
        </focalMechanism>
      </ruptureRateModel>
      <ruptureDepthDistribution>
        <magnitude>6.5</magnitude>
        <depth>5.0</depth>
      </ruptureDepthDistribution>
      <hypocentralDepth>5.0</hypocentralDepth>
    </areaSource>
  </sourceModel>
\end{Verbatim}


%
% ============================================================================== 
\section{Ground-motion system file description}
\end{comment}