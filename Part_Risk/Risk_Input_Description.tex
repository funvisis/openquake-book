The two main sources of input information required for a risk calculation with OpenQuake are an exposure model and a vulnerability model (in addition to the calculation type, such as those described in Chapter \ref{chap:intrisk}, and the region of interest). An exposure model for a given asset category describes, at each location of interest within a given region, the value of each asset typology. The vulnerability model describes the vulnerability characteristics of each asset typology.
%_________________________________________________________
\section{Exposure}
The OpenQuake engine requires an exposure model that needs to be stored according to the respective NRML schema. This file format can include several typologies of asset such as population or buildings. The following parameters are currently being used to describe each asset of the exposure model: 

\begin{itemize}
\item Asset reference: A unique key used to identify the asset instance;
\item Asset value: Numerical value of the quantity of the asset;
\item Location: Geographic coordinates of the asset expressed in decimal degrees;
\item Vulnerability function: Code of the vulnerability curve that should be employed on the calculations;
\item Structure type: Reference to the structure typology.
\end{itemize}

This list of parameters will be further extended in future releases of OpenQuake once more complex data will need to be stored (e.g. value of contents or number of occupants per building at different times of the day).  

\section{Vulnerability}
Vulnerability is defined as the probability distribution of loss, given an intensity measure level. Vulnerability functions can be derived directly, usually through empirical methods where the losses from past events at given locations are related to the levels of intensity of ground motion at those locations, or they can be derived by combining fragility functions and consequence functions. Fragility functions describe the probability of exceeding a set of limit states, given an intensity measure level; limit states describe the limits to performance levels, such as damage or injury levels. Fragility functions can be derived by expert-opinion, empirically (using observed data), or analytically, by explicitly modeling the behavior of a given asset typology when subjected to increasing levels of ground motion. Consequence functions describe the probability distribution of loss, given a performance level and are generally derived empirically. 

Version 0.4 of OpenQuake only supports vulnerability functions. As part of the Modeller's Toolkit development, calculators that combine fragility functions and consequence functions to produce vulnerability functions will be produced in the future. Furthermore, the possibility to input fragility functions directly is planned in future releases of OpenQuake such that users can view intermediate results of seismic loss calculations, such as the distribution of damage. 

\subsection{Vulnerability Function}
\subsubsection{Discrete Vulnerability Functions}
In the current version of OpenQuake (V0.4) discrete vulnerability functions are used to directly estimate human and economic losses. Discrete vulnerability functions are described by a list of intensity measure levels and corresponding mean loss ratios (the ratio of mean loss to exposed value), associated coefficients of variation and probability distributions. The uncertainty on the loss ratio is assumed in OpenQuake v0.4 to follow a lognormal distribution, however different probabilistic distributions for the uncertainty will be developed in future versions such as the beta distribution. Figure \ref{fig:VFDiscrete} illustrates a discrete vulnerability function.

\begin{figure}[ht]
\centering
\includegraphics[width=10cm,height=6cm]{./Figures/Part_Risk/VFDiscrete.eps}
\caption{Discrete vulnerability function.}
\label{fig:VFDiscrete}
\end{figure}

\subsubsection{Continuous Vulnerability Functions}
The plan is to implement continuous vulnerability functions in future versions of OpenQuake. Continuous vulnerability functions are described by continuous distributions of mean loss ratio and coefficient of variation, with ground motion intensity. Figure \ref{fig:VFContinuous} illustrates this type of function.

\begin{figure}[ht]
\centering
\includegraphics[width=10cm,height=6cm]{./Figures/Part_Risk/VFContinuous}
\caption{Continuous vulnerability function.}
\label{fig:VFContinuous}
\end{figure}

\subsection{Fragility Functions}
Fragility functions describe the probability of exceeding a set of limit states, given an intensity measure level. When the asset category concerns structures (e.g. buildings), the intensity measure can either be structure-independent or structure-dependent. The former can be calculated directly from recorded measurements of ground shaking (e.g. peak ground acceleration, peak ground velocity, spectral acceleration at a given period of vibration, or even macroseismic intensity). The latter requires information on the characteristics of the structures in order to be calculated, for example spectral acceleration at the fundamental period of vibration, or spectral displacement at the limit state period of vibration. The calculation of these structural characteristics might be through a simple formula (e.g. a yield period-height equation, see e.g. \citet{CrowleyPinho2004} ) or through so-called non-linear static methods, which are needed when the intensity measure is a non-linear response quantity such as spectral displacement at the limit state period of vibration (see e.g. \citet{FEMA440ATC2005}).
Discrete and continuous fragility functions with structure-independent and structure dependent intensity measures (and the methods necessary to calculate them) are not currently supported, but they will be implemented in future versions of OpenQuake. 

\subsubsection{Discrete Fragility Functions}
Fragility functions can be defined in a discrete way by providing for each limit state a list of intensity measure levels and respective probabilities of exceedance. Figure \ref{fig:FFDiscrete} presents a set of discrete fragility functions using a macroseismic intensity measure. As mentioned previously, these are not yet supported by OpenQuake.

\begin{figure}[ht]
\centering
\includegraphics[width=10cm,height=6cm]{./Figures/Part_Risk/FFDiscrete.eps}
\caption{Set of discrete fragility function.}
\label{fig:FFDiscrete}
\end{figure}

\subsubsection{Continuous Fragility Functions}
Continuous fragility functions are defined by the parameters of a cumulative distribution function. In Figure \ref{fig:FFcontinuous} an example of a set of continuous fragility functions with a structure-dependent intensity measure is presented. As mentioned previously, these are not yet supported by OpenQuake.

\begin{figure}[ht]
\centering
\includegraphics[width=10cm,height=6cm]{./Figures/Part_Risk/FFContinuous.eps}
\caption{Set of continuous fragility function.}
\label{fig:FFcontinuous}
\end{figure}

\subsection{Consequence Functions}
Consequence functions describe the probability distribution of loss, given a performance level. For example, if the asset category is buildings and the performance level is significant damage, the consequence function will describe the mean loss ratio, coefficient of variation and probability distribution for that level of damage. Figure \ref{fig:ConsequenceFunctions} presents the mean damage ratio for a set of performance levels proposed by two different sources. 

\begin{figure}[ht]
\centering
\includegraphics[width=10cm,height=6cm]{./Figures/Part_Risk/ConsequenceFunction.eps}
\caption{Consequence functions adapted from  \citet{Baletal2010}}
\label{fig:ConsequenceFunctions}
\end{figure}

